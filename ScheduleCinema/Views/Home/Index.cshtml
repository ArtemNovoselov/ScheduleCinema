@model ScheduleCinema.ViewModels.CityCinemasScheduleViewModel

<link href="@Url.Content("~/Content/jquery.datetimepicker.css")" rel="stylesheet" type="text/css" />

@section scripts
{
    <script type="text/javascript" src="~/Scripts/jquery.datetimepicker.js"></script>
    <script type="text/javascript">
        jQuery('#scheduleDate').datetimepicker({
            format: 'd.m.Y'
        });
    </script>
}

<div class="row">
    @using (Html.BeginForm(null, null, FormMethod.Get))
    {
        <div class="col-md-4">
            Дата: <input id="scheduleDate" name="scheduleDate" type="text" value="@ViewBag.Date" />
        </div>
        <div class="col-md-4">
            <input id="editschedule" type="submit" value="Показать" formaction="@Url.Action("Index")" />
        </div>
        <div class="col-md-4">
            <input id="saveschedule" type="submit" value="Добавить" formaction="@Url.Action("Create", "CinemaSchedules")" />
        </div>
    }
</div>

@if (Model == null)
{
    <div class="text-info">
        <p>
            @ViewBag.Error
        </p>
    </div>
}
else
{
        @Html.LabelFor(model => Model.CinemaSchedulesGroups, htmlAttributes: new { @class = "control-label col-md-2" })
        foreach (var group in Model.CinemaSchedulesGroups)
        {
            <div style="margin-bottom: 10px;">
                <div class="text-warning" style="clear: both;">
                    @Html.DisplayFor(display => group.Key.CinemaName)
                </div>
                <table>
                    @foreach (var schedule in group)
                    {
                        var movieGroups = schedule.CinemaSessions.GroupBy(movie => new { movieName = movie.Movie.MovieName, movieId = movie.Movie.MovieId });
                        foreach (var movieGroup in movieGroups)
                        {
                            <tr>
                                <td class="col-md-10">
                                    @movieGroup.Key.movieName
                                </td>
                                <td class="col-md-10">
                                    @string.Join(",", movieGroup.Select(session => session.CinemaSessionTime))
                                </td>
                                <td class="col-md-10">
                                    <a href="@Url.Action("Edit", "CinemaSchedules", new {id = schedule.CinemaScheduleId, movieId = movieGroup.Key.movieId})">Редактировать</a>
                                </td>
                            </tr>
                        }
                    }
                </table>
            </div>
        }
}
